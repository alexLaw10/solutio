<div class="table-container">

  <div 
    *ngIf="warningMessage" 
    class="warning" 
    role="alert" 
    aria-live="assertive"
    aria-atomic="true">
    {{ warningMessage }}
  </div>

  <solutio-v2-filter
    [form]="form"
    [loading]="loading"
    [minDate]="minDate"
    [maxDate]="maxDate"
    [cityOptions]="cityOptions"
    (startChange)="onStartDateChange($event)"
    (endChange)="onEndDateChange($event)"
    (cityChange)="onCityChange($event)"
    (submitFilter)="applyFilter()"
  ></solutio-v2-filter>

  <div 
    *ngIf="loading"
    class="loading" 
    role="status"
    aria-live="polite"
    aria-atomic="true"
    aria-label="Carregando dados">
    <solutio-v2-spinner size="md"></solutio-v2-spinner>
    <span>Carregando dados meteorológicos...</span>
  </div>

  <div *ngIf="!loading && displayedData.length > 0" role="region" aria-label="Tabela de dados meteorológicos">
    <table role="table" aria-label="Séries horárias de dados meteorológicos">
      <caption class="sr-only">Tabela contendo dados meteorológicos por hora incluindo data, temperatura, probabilidade de precipitação, umidade e vento</caption>
      <thead>
        <tr>
          <th scope="col">Data</th>
          <th scope="col">Temperatura (°C)</th>
          <th scope="col">Precip (%)</th>
          <th scope="col">Umidade</th>
          <th scope="col">Vento</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let row of displayedData; trackBy: trackByRow">
          <td>
            <time [dateTime]="row.time">{{ row.time | dateFormat:'short' }}</time>
          </td>
          <td>
            <span [attr.aria-label]="getTemperatureAriaLabel(row.temp)">{{ row.temp }}°C</span>
          </td>
          <td>
            <span [attr.aria-label]="getPrecipitationAriaLabel(row.prec)">{{ row.prec }}%</span>
          </td>
          <td>
            <span [attr.aria-label]="getHumidityAriaLabel(row.hum)">{{ row.hum | percentage }}</span>
          </td>
          <td>
            <span [attr.aria-label]="getWindSpeedAriaLabel(row.wind)">{{ row.wind | speed }}</span>
          </td>
        </tr>
      </tbody>
    </table>

    <div 
      *ngIf="displayedData.length === 0"
      role="status"
      aria-live="polite"
      class="table-container__empty">
      <p>Nenhum dado disponível para os filtros selecionados.</p>
    </div>
  </div>

  <div *ngIf="showLoadMoreButton" class="table-container__load-more">
    <button
      type="button"
      class="btn btn--primary"
      [disabled]="loadingMore"
      [attr.aria-label]="'Carregar mais registros. Atualmente exibindo ' + displayedData.length + ' de ' + tableData.length + ' registros'"
      (click)="loadMore()">
      <solutio-v2-spinner *ngIf="loadingMore" size="sm" color="white"></solutio-v2-spinner>
      {{ loadingMore ? 'Carregando...' : 'Carregar mais' }}
    </button>
    <p class="table-container__info" aria-live="polite">
      Exibindo <span class="sr-only">dados</span> {{ displayedData.length }} de {{ tableData.length }} registros
    </p>
  </div>

  <div *ngIf="showAllLoadedMessage" class="table-container__all-loaded" role="status" aria-live="polite">
    <p>Todos os {{ tableData.length }} registros estão sendo exibidos</p>
  </div>

</div>
